# 관리자 콘솔 사용법

## 개요
관리자 콘솔은 작업관리 시스템의 데이터를 대량으로 업로드하고 관리할 수 있는 별도 웹 인터페이스입니다. 엑셀 파일을 통한 데이터 업로드, 작업자/현장 관리, Supabase 연동 등의 기능을 제공합니다.

## 주요 기능

### 1. 작업 데이터 업로드
- **지원 형식**: .xlsx, .xls
- **필수 컬럼**: 현장, 작업자, 공수, 메모, 년-월-일
- **기능**: 
  - 엑셀 파일 드래그 앤 드롭 또는 파일 선택
  - 데이터 미리보기 및 검증
  - 중복 데이터 자동 감지
  - 작업자별 급여 자동 계산 (기본급 또는 시간당 단가 기준)
  - 세금(3.3%) 자동 계산

### 2. 경비 데이터 업로드
- **지원 형식**: .xlsx, .xls
- **필수 컬럼**: 현장, 사용일, 항목, 금액, 사용처, 주소, 메모
- **기능**:
  - 엑셀 파일 업로드
  - 데이터 미리보기 및 검증
  - 중복 데이터 자동 감지

### 3. 작업자 관리
- 작업자 추가/삭제
- 월 기본급 설정
- 시간당 단가 설정
- 급여 계산 기준 설정

### 4. 현장 관리
- 현장 추가/삭제
- 현장 주소 및 담당자 정보 관리

### 5. 시스템 설정
- Supabase 연결 설정
- 세율 설정 (기본값: 3.3%)
- 데이터베이스 연결 테스트

### 6. 데이터 동기화
- Supabase와의 실시간 동기화
- 전체 데이터 내보내기
- 데이터 현황 모니터링

## 사용 방법

### 1. 초기 설정
1. `admin-console.html` 파일을 웹 브라우저에서 열기
2. "시스템 설정" 탭에서 Supabase 정보 입력
   - Supabase URL 입력
   - API Key 입력
   - 세율 설정 (기본값: 3.3%)
3. "설정 저장" 버튼 클릭
4. "연결 테스트" 버튼으로 연결 확인

### 2. 작업자 및 현장 등록
1. "작업자 관리" 탭에서 작업자 정보 입력
   - 작업자명, 월 기본급 또는 시간당 단가
2. "현장 관리" 탭에서 현장 정보 입력
   - 현장명, 주소, 담당자

### 3. 작업 데이터 업로드
1. "작업 데이터 업로드" 섹션에서 엑셀 파일 선택
2. 파일 형식 확인 (필수 컬럼 포함)
3. 데이터 미리보기 확인
4. "데이터 처리" 버튼 클릭
5. 처리 결과 확인

### 4. 경비 데이터 업로드
1. "경비 데이터 업로드" 섹션에서 엑셀 파일 선택
2. 파일 형식 확인 (필수 컬럼 포함)
3. 데이터 미리보기 확인
4. "데이터 처리" 버튼 클릭
5. 처리 결과 확인

### 5. 데이터 동기화
1. "Supabase 동기화" 버튼으로 클라우드 동기화
2. "전체 데이터 내보내기"로 백업 파일 생성
3. "데이터 현황 보기"로 시스템 상태 확인

## 엑셀 파일 형식

### 작업 데이터 형식
| 년-월-일 | 현장 | 작업자 | 공수 | 메모 |
|---------|------|--------|------|------|
| 2024-01-15 | 서울역 공사현장 | 김철수 | 8 | 철근 작업 |
| 2024-01-15 | 서울역 공사현장 | 이영희 | 6 | 콘크리트 타설 |

### 경비 데이터 형식
| 사용일 | 현장 | 작업자 | 항목 | 금액 | 사용처 | 주소 | 메모 |
|--------|------|--------|------|------|--------|------|------|
| 2024-01-15 | 서울역 공사현장 | 김철수 | 철근 | 500000 | 철근상사 | 서울시 용산구 | 1월 철근 구매 |

## 데이터 처리 로직

### 중복 데이터 처리
- **작업 데이터**: 일자 + 현장 + 작업자 기준으로 중복 체크
- **경비 데이터**: 일자 + 현장 + 항목 + 금액 기준으로 중복 체크
- 중복 발견 시 기존 데이터 유지, 신규 데이터 무시

### 급여 계산
1. **시간당 단가가 설정된 경우**: 공수 × 시간당 단가
2. **월 기본급만 설정된 경우**: (월 기본급 ÷ 160시간) × 공수
3. **세금 계산**: 총 급여 × 3.3%
4. **실수령액**: 총 급여 - 세금

### 미일치 데이터 처리
- 등록되지 않은 작업자로 작업 기록 시 미일치로 분류
- 미일치 데이터는 별도 로그에 기록하여 관리자 확인 필요

## Supabase 연동

### 데이터베이스 스키마
- `workers`: 작업자 정보
- `sites`: 현장 정보
- `work_records`: 작업 기록
- `expense_records`: 경비 기록
- `system_config`: 시스템 설정

### 자동 동기화
- 데이터 처리 완료 시 자동으로 Supabase에 업로드
- upsert 방식으로 중복 데이터 처리
- 실시간 동기화로 데이터 일관성 보장

## 주의사항

1. **파일 형식**: 반드시 첫 번째 행에 컬럼명 포함
2. **날짜 형식**: YYYY-MM-DD, YYYY/MM/DD, YYYYMMDD 형식 지원
3. **데이터 백업**: 정기적으로 "전체 데이터 내보내기" 실행 권장
4. **연결 확인**: Supabase 연결 상태를 주기적으로 확인
5. **권한 관리**: 관리자만 접근 가능하도록 설정 권장

## 문제 해결

### 파일 업로드 실패
- 파일 형식 확인 (.xlsx, .xls)
- 필수 컬럼 포함 여부 확인
- 파일 크기 제한 확인

### Supabase 연결 실패
- URL과 API Key 정확성 확인
- 네트워크 연결 상태 확인
- Supabase 프로젝트 상태 확인

### 데이터 처리 오류
- 콘솔 로그 확인
- 데이터 형식 검증
- 필수 필드 누락 여부 확인

## 기술 스택

- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **Excel 처리**: SheetJS (XLSX)
- **데이터베이스**: Supabase (PostgreSQL)
- **스토리지**: LocalStorage (로컬 백업)
- **UI Framework**: Custom CSS with CSS Variables

## 지원 및 문의

시스템 사용 중 문제가 발생하거나 추가 기능이 필요한 경우, 개발팀에 문의하시기 바랍니다.
